@using Controls.Collapsibles
@using Controls.Buttons
@using Controls.Selection
@using Controls.Css

<Button
    CssClasses=CssClasses
    CssStyles=CssStyles
    OnClick=OnClick
    OnHover=OnHover
>
    <CollapsibleSelector IsCollapsed="isSelected">@Text</CollapsibleSelector>
</Button>

<div class="nav-header-children">
    <Collapsible IsCollapsed="isSelected">
        <CascadingValue Value=this IsFixed=true>
            @ChildContent
        </CascadingValue>
    </Collapsible>
</div>

@code {
    private bool isHovered, isSelected;

    private Styles CssStyles => 
        isSelected
        ? SelectedStyle 
        : isHovered ? HoverStyle : DefaultStyle;

    [CascadingParameter]
    public NavHeader? CurrentHeader { get; set; }

    [Parameter, EditorRequired]
    public Styles DefaultStyle { get; set; }

    [Parameter, EditorRequired]
    public Styles HoverStyle { get; set; }

    [Parameter, EditorRequired]
    public Styles SelectedStyle { get; set; }

    [Parameter]
    public Classes? CssClasses { get; set; }

    [Parameter, EditorRequired]
    public string? Text { get; set; }

    [Parameter, EditorRequired]
    public RenderFragment? ChildContent { get; set; }

    public void Select(bool isSelected)
    {
        this.isSelected = isSelected;
        CurrentHeader?.Select(isSelected);
    }

    private void OnHover(bool isHovered) => this.isHovered = isHovered;

    private void OnClick() => isSelected = !isSelected;
}
