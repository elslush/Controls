@using Controls.Buttons
@using Controls.Collapsibles
@using Controls.Selection
@using Controls.Sidebars.States
@using System.Text.RegularExpressions

<Button
    href=@Link
    class=@SelectedClass
    @onclick=OnClick
    ChildContent=ChildContent
/>

@code {
    private string? SelectedClass => SelectionContainer?.IsSelected(Link) ?? false ? "selected fade" : null;

    [CascadingParameter]
    public SingleSelectionContainer<string>? SelectionContainer { get; set; }

    [CascadingParameter]
    public NavHeader? CurrentHeader { get; set; }

    [Parameter, EditorRequired]
    public RenderFragment ChildContent { get; set; }

    [Parameter]
    public string Link { get; set; } = string.Empty;

    private Task OnClick() => SelectionContainer?.AddValue(Link) ?? Task.CompletedTask;

    protected override void OnAfterRender(bool firstRender)
    {
        if (firstRender && SelectionContainer is not null)
        {
            if (SelectionContainer.IsSelected(Link))
                CurrentHeader?.Select(true);
            SelectionContainer.OnActiveValueChanged += (sender, e) => StateHasChanged();
        }
    }
}