@using Controls.CssStates
@using Controls.Selection
@using Controls.Buttons
@implements ITab

<li>
    <a
        @onmouseover="OnMouseOver"
        @onmouseout="OnMouseOut"
        @onclick="ActivateTab" 
        class="tab-item" 
        style="@Style" 
        role="button"
    >
        @Content
    </a>
</li>

@code {
    private bool isHovered;

    private string Style 
    {
        get
        {
            if (SelectionContainer?.ActiveValue == this)
                return SelectionColors.Value;
            if (isHovered)
                return HoverColors.Value;
            return DefaultColors.Value;
        }
    }

    [CascadingParameter]
    public SingleSelectionContainer<ITab>? SelectionContainer { get; set; }

    [Parameter, EditorRequired]
    public CssStyle DefaultColors { get; set; }

    [Parameter, EditorRequired]
    public CssStyle HoverColors { get; set; }

    [Parameter, EditorRequired]
    public CssStyle SelectionColors { get; set; }

    [Parameter, EditorRequired]
    public RenderFragment? Content { get; set; }

    [Parameter, EditorRequired]
    public RenderFragment? ChildContent { get; set; }

    [Parameter]
    public bool IsDefault { get; set; }

    [Parameter]
    public EventCallback OnSelect { get; set; }

    protected override async Task OnInitializedAsync()
    {
        if (IsDefault)
            await ActivateTab();
    }

    private Task ActivateTab()
    {
        SelectionContainer?.UpdateValue(this);
        return OnSelect.InvokeAsync();
    }

    private void OnMouseOver() => isHovered = true;

    private void OnMouseOut() => isHovered = false;
}
